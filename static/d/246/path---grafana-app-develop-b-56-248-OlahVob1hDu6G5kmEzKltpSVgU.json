{"data":{"site":{"siteMetadata":{"title":"Blog","author":"susiezhao"}},"markdownRemark":{"id":"f2cb7447-4273-54aa-9e3c-8106caaaeb77","excerpt":"Grafana APP 插件 Grafana APP 插件的目录结构及配置文件 Grafana APP 开发实践 Datasource Plugin 的开发 Datasource 模块 ConfigCtrl 模块 Grafana APP 插件 Grafana…","html":"<!-- TOC -->\n<ul>\n<li>\n<p><a href=\"#grafana-app-%E6%8F%92%E4%BB%B6\">Grafana APP 插件</a></p>\n<ul>\n<li><a href=\"#grafana-app-%E6%8F%92%E4%BB%B6%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%8F%8A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\">Grafana APP 插件的目录结构及配置文件</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#grafana-app-%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5\">Grafana APP 开发实践</a></p>\n<ul>\n<li><a href=\"#datasource-plugin-%E7%9A%84%E5%BC%80%E5%8F%91\">Datasource Plugin 的开发</a></li>\n<li><a href=\"#datasource-%E6%A8%A1%E5%9D%97\">Datasource 模块</a></li>\n<li><a href=\"#configctrl-%E6%A8%A1%E5%9D%97\">ConfigCtrl 模块</a></li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h1>Grafana APP 插件</h1>\n<p>Grafana 是一个开源的时序性统计和监控平台，支持例如 elasticsearch、graphite、influxdb 等众多的数据源，并以功能强大的界面编辑器著称，允许您对指标进行查询、可视化展示、设置告警等操作，以及自定义配置仪表盘。 </p>\n<p>Grafana 已经拥有一个强大的贡献者和插件开发者社区。开发者社区提供了三种类型的插件： </p>\n<ul>\n<li>Panel Plugin: 针对图形展示的面板插件；</li>\n<li>Datasource Plugin: 针对数据源的插件；</li>\n<li>App Plugin: 针对完整应用的插件，通常由 Panel Plugin，Datasource Plugin 以及 Dashboards 模板组成；</li>\n</ul>\n<h2>Grafana APP 插件的目录结构及配置文件</h2>\n<p>本文主要介绍的是 App Plugin 的开发过程以及相关的代码组织。基于腾讯云云监控 API 的 Tencent Cloud Monitor App 插件(<a href=\"https://github.com/TencentCloud/tencentcloud-monitor-grafana-app\">TencentCloud/tencentcloud-monitor-grafana-app</a>)，主要由两部分组成： Datasource Plugin 和 Dashboards 模板组成，代码的目录结构如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── CHANGELOG.md\n├── LICENSE\n├── README.md\n├── dist                                        // 文件夹，文件夹 src 打包后的代码\n├── package.json\n├── src\n│   ├── components\n│   │   ├── config.html\n│   │   └── config.ts\n│   ├── dashboards                              // Dashboards 典型模板存放\n│   │   ├── example_cdb_dashboard.json\n│   │   └── example_cvm_dashboard.json\n│   ├── datasource                              // Datasource Plguin 代码\n│   │   ├── __mocks__\n│   │   │   └── core_module.ts\n│   │   ├── common\n│   │   │   ├── constants.ts\n│   │   │   └── sign.ts\n│   │   ├── components                          // 自定义的 Angular 组件\n│   │   │   ├── custom_select_dropdown.ts\n│   │   │   └── multi_condition.ts\n│   │   ├── css\n│   │   │   └── query_editor.css\n│   │   ├── config.ctrl.ts                       // ConfigCtrl 模块\n│   │   ├── datasource.ts                        // Datasource 模块\n│   │   ├── query.ctrl.ts                        // QueryCtrl 模块\n│   │   ├── img\n│   │   │   └── tencent-cloud.svg\n│   │   ├── partials                             // Datasource Plugin 中的 html 页面\n│   │   │   ├── config.html                      // config.ctrl.ts 对应的 html\n│   │   │   ├── query.editor.html                // query.ctrl.ts 对应的 html\n│   │   ├── module.ts                            // Datasource Plguin 的 module.ts\n│   │   ├── plugin.json                          // Datasource Plguin 的 module.ts\n│   │   ├── specs                                // 测试用例文件夹\n│   │   │   ├── tc_monitor_cdb_datasource.test.ts\n│   │   │   └── tc_monitor_cvm_datasource.test.ts\n│   │   └── tc_monitor                           // 云监控相关的产品\n│   │       ├── cdb\n│   │       │   ├── datasource.ts\n│   │       │   ├── query.ts\n│   │       │   └── query_def.ts\n│   │       ├── cvm\n│   │       │   ├── datasource.ts\n│   │       │   ├── query.ts\n│   │       │   └── query_def.ts\n│   │       └── index.ts\n│   ├── image                                    // 文件夹，存放README.md 中图片\n│   ├── img\n│   │   └── tencent-cloud.svg\n│   ├── module.ts                                // App Plguin 的 module.ts\n│   └── plugin.json                              // App Plugin 的 plugion.json\n├── jest.config.js                               // jest 框架的配置信息\n├── tsconfig.jest.json\n├── tsconfig.json\n├── tslint.json\n├── webpack.config.analyze.js\n├── webpack.config.js\n└── webpack.config.prod.js</code></pre></div>\n<p>在插件开发中存在两个重要的配置文件： <strong>plugin.json</strong> 和 <strong>module.ts</strong>。</p>\n<ul>\n<li><code>plugin.json</code>: 每一个插件中必不可少的文件，用于描述插件的相关信息。在 Grafana 服务启动时会扫描所有的插件文件夹并挂载每个插件的 dist 目录，并查找 <code>plugin.json</code> 文件，根据文件的内容完成插件的自动注册。 一个App plugin 的 <code>plugion.json</code> 如下：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">/* App Plugin 的 plugin.json */</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span>                                          <span class=\"token comment\">// 插件的类型： panel | app | datasource</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor\"</span><span class=\"token punctuation\">,</span>                        <span class=\"token comment\">// 插件名称</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tencentcloud-monitor-app\"</span><span class=\"token punctuation\">,</span>                       <span class=\"token comment\">// 插件ID, 必须唯一</span>\n  <span class=\"token property\">\"info\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor App for Grafana\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"tencentcloud\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"tencentcloudmonitor\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"grafana\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"plugins\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"logos\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"small\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"large\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"updated\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2019-04-10\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"includes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>                                            <span class=\"token comment\">// App Plugin 中包含的 Datasource Plugin 和 Dashboards 模板信息</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dashboard\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"【实例】CDB 单机监控\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dashboards/example_cdb_dashboard.json\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dashboard\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"【实例】CVM 单机监控\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dashboards/example_cvm_dashboard.json\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"datasource\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor Datasource\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"grafanaVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"6.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Datasource Plugin 的 <code>plugin.json</code> 如下：:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token comment\">/* Datasource Plugin 的 plugin.json */</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"datasource\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor Datasource\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tencentcloud-monitor-datasource\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"metrics\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>                           <span class=\"token comment\">// Datasource plugin 特有的属性，是否在 panel 中支持 metrics</span>\n  <span class=\"token property\">\"annotations\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>                       <span class=\"token comment\">// // Datasource plugin 特有的属性，是否在 dashboard 中支持 annotations 查询</span>\n  <span class=\"token property\">\"queryOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"maxDataPoints\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"routes\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"info\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tencent Cloud\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"logos\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"small\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"large\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>特别注意</strong>： Datasource Plugin 的 <code>plugin.json</code> 配置中必须存在 <strong>metric</strong> 和 <strong>annotations</strong>，且其中至少有一个属性的值为 <code>true</code>。</p>\n<ul>\n<li><code>module.ts</code>：插件的入口文件，决定了插件的具体实现的。根据插件的类型不同其内容也有所差异。 </li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* App Plugin 的 module.ts 需要导出1个模块 */</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span>\n  ConfigCtrl<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Datasource Plugin 的 module.ts 通常需要导出5个模块 */</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span>\n  Datasource<span class=\"token punctuation\">,</span>                 <span class=\"token comment\">// Required</span>\n  ConfigCtrl<span class=\"token punctuation\">,</span>                 <span class=\"token comment\">// Required</span>\n  QueryCtrl<span class=\"token punctuation\">,</span>                  <span class=\"token comment\">// Required</span>\n  AnnotationsQueryCtrl<span class=\"token punctuation\">,</span>\n  QueryOptionsCtrl\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Grafana APP 开发实践</h1>\n<p>基于腾讯云云监控 API 的 Tencent Cloud Monitor App 完整的结构图如下所示：<br>\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a1a042e560c6857c469bef52b5685ce/5edb4/grafana_app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.06493506493506%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAC1klEQVQ4y32UWU8aURTHqSsqiAIzDNsMIMpStzZxoVTsk4pL0qbW1C19ao0foZ+iaT+Cfa+J8ckmJtJHn2yEiC0uEYmaiGF5UCL8e+5FG1Mbz+TmhLn/+Z3/mTkXVW8ghN7uLjxu74TH44XJZIZeb4BaXYeVlRUkk0lEo1Gw+La8DPlJCH39QQSfdqKvsx0uhxOiaIJGU48PCwtQ+RU7nJKI5mYjGho0tKGlrEVFRRVWV1dxcZHG+fk5By4tfSWdgUMUkwipSQedVguNTg/J4sfiewJ+nJnD69EJDIdHMTY2frMmMDQ0gs3NTZRKJeRyOQ5cW/uO4eEwJt9MITw6jjDpuH7iJd7OLuLLp89Q4YHI5/NIp9O8beby8vKS32dF/o3r6wJKdKmKtFksFu8tFnt7e9jZ2cHp6SnOzs6QyWRQKBRwdXXF8139bZEHHTJniUSCg26LPBQMqioWr5HYP8TvxD4ODg6wu/sL8Xicg1je2triQNYu+9qxWIxcx7G9vc33otEY5Z/07GHZYT6XxeDIK/i6+9Hd1YW2Ni9crhbY7TJk2YGqqmqsr6/j5OQEeoMIoyDRmEj8azc2NvGsUj3C5OTUDZBe/LNAABbJDLPFBrPZCkEwQaLfoiCisrIaGxsRJI+OIMluONw+PqdGo8jBTK9W12OGpoUD2UgEn4fgcLq5I6vVBpNkgZXgNguJ6xoQifzA8fExmvVGWG0KnKRVHC44aLlbPdBodZiff1cGZrNZDIRewGZX/rrT04NaEjEHrHokEkEqlYKGBp4V9fk7eKsGg0CdWFBbW0cOZ+84DIYgMyBNv9Fo4lAGY+Iy8NahAFlx0Tt28+Jmsw0erx86TeOdlrM5BAYH4HYqaLXJEOgss7N5H5jirq2kafP4ac8Ki5WOLcHZUZ2bm78BZgg4PoCejhb0KC0wEkQU/g/UkBNZccLra+ftssX+TGpq1JieLrf8B3fNrt/F18X3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Tencent Cloud Monitor App 的结构图\"\n        title=\"\"\n        src=\"/static/9a1a042e560c6857c469bef52b5685ce/b9e4f/grafana_app.png\"\n        srcset=\"/static/9a1a042e560c6857c469bef52b5685ce/cf440/grafana_app.png 148w,\n/static/9a1a042e560c6857c469bef52b5685ce/d2d38/grafana_app.png 295w,\n/static/9a1a042e560c6857c469bef52b5685ce/b9e4f/grafana_app.png 590w,\n/static/9a1a042e560c6857c469bef52b5685ce/f9b6a/grafana_app.png 885w,\n/static/9a1a042e560c6857c469bef52b5685ce/2d849/grafana_app.png 1180w,\n/static/9a1a042e560c6857c469bef52b5685ce/5edb4/grafana_app.png 1540w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n      </p>\n<p>在整个应用开发中最为重要的部分是 Datasource Plugin 模块的开发，下面我们以该模块为例详细介绍。</p>\n<h2>Datasource Plugin 的开发</h2>\n<p>Datasource 插件中有3个必须的模块：<code>Datasource</code>、 <code>QueryCtrl</code> 和 <code>ConfigCtrl</code>；\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e8d31ceb3f2953231049991ba36b35f9/0eed5/datasource.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.08458864426419%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAA90lEQVQY022Qy26DMBBF+f9/qlRllXZBgBRIwxubYIwDBhPMy7hOUqqq6tHV1Wxm5s5o6yq/Je+IR/GUfLgQKyY0x1eIcJhkfpQGMYSITLPQ5C9msZ5AbXiF4Rf6Ge1t8OZkgPR+gqxTfPxM9A9/tzdMJxjGWQ3VnLRxU+qCxorqlHA+LjWbaDfVbKzYoLzjC2kHXN2qlldtT2hHu+GZS9tZ+auZKb0coAuYyh9cWivAdkTuHl9ND73bMEZMbrf8oLX9wgbBuKhvi3LKxqzsYMkAZglqlEDBWD/Ni9i+o9ia/9zsZY0VlnZMjmF58JB+ztV+Pgr5H18o81EbMljENAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"完整的 Datasource\"\n        title=\"\"\n        src=\"/static/e8d31ceb3f2953231049991ba36b35f9/b9e4f/datasource.png\"\n        srcset=\"/static/e8d31ceb3f2953231049991ba36b35f9/cf440/datasource.png 148w,\n/static/e8d31ceb3f2953231049991ba36b35f9/d2d38/datasource.png 295w,\n/static/e8d31ceb3f2953231049991ba36b35f9/b9e4f/datasource.png 590w,\n/static/e8d31ceb3f2953231049991ba36b35f9/0eed5/datasource.png 863w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Datasource 模块</h3>\n<p>在基于 Tencent Cloud Monitor App 的</p>\n<h3>ConfigCtrl 模块</h3>\n<p>主要用于定义数据源的配置信息，具体页面展示如下：\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5371a02dd8247fa0bd1676d6863d678/91670/datasource_config.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 85.38461538461539%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACdklEQVQ4y5WUyXLTQBCGdY2teNEujSzNyLI22/EWx45DcUgRqEA4cOMtOENx5XV4xZ/ucZyYEChy+KtlS/3N34tkFKMR1OIa8dkbzGcLbDaXWK3WWC7PUddjjMdTTCZTNM2ExL/3sSwrFEWJ4TDXsiwb7bYJY0Q3gs9f0P/0DZtX17j7cIebm3e4vX2P7XaH9foCu92VBh2DGVbXDaqq1te27eyBVVWRsxqLcYVSKQwGkpRCiAHiONExCCJ4nq+T2EmvZ6Hb7eH0tAPTPEWr1dbRNAmo1BCZTDFtashUIk2VBjIsimKS0EBWGAoCB3AcD7ZDB3B8cojBDyZphkgQgNwcnLEOYI6RiCnZ1fdTmSEJA0R+QAeE8P1HEVBgMp1jkCitAyBJJCQl8rXKhhrUaplQKsd0tkIdu0g9G7ZLUNeHey+Dy2AIA7h8hliWg37f1pFd8bVtubpcTtIlE8ih6/1/gY4sgx1st1eYzZZaDU1TO0tS3TdO5gP5YIYxXB9AvTu4OsA0kB+83L3GfLGGiCW5cpHRXhVFpcu0KJGB3B8GcdknJ20aQP95oO9HKCvaq7JBGA30n1wmix/maJodWpEuOp3e/TT7uh3PAtlFnhfIslwvaBSnVKb/0C+OhwkeJx7fP4YaXM7qfENbP0E9nqGRMULHpob/nvicnsL2PaTlXa4uINUIMq9xnnqQLk34yOW/9IfDgHqYZwVEMNBDkcKH77p6JY4Tnjr5mwwvoH1KqT8ZvWIixMgTUL546Nn/gh5Lnkpsvt9i/eMjNm/P8HN+ja/lAmcL2kn6fPGUXwRkh74iRxkNQ0So3RBDej/1B4FcvtThLyPmxEia9bgoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Tencent Cloud Monitor App 的 Datasource Plugin 的数据源配置\"\n        title=\"\"\n        src=\"/static/c5371a02dd8247fa0bd1676d6863d678/b9e4f/datasource_config.png\"\n        srcset=\"/static/c5371a02dd8247fa0bd1676d6863d678/cf440/datasource_config.png 148w,\n/static/c5371a02dd8247fa0bd1676d6863d678/d2d38/datasource_config.png 295w,\n/static/c5371a02dd8247fa0bd1676d6863d678/b9e4f/datasource_config.png 590w,\n/static/c5371a02dd8247fa0bd1676d6863d678/f9b6a/datasource_config.png 885w,\n/static/c5371a02dd8247fa0bd1676d6863d678/2d849/datasource_config.png 1180w,\n/static/c5371a02dd8247fa0bd1676d6863d678/91670/datasource_config.png 1300w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n      </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* /src/datasource/config.ctrl.ts */</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> _ <span class=\"token keyword\">from</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SERVICES</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./tc_monitor'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TCMonitorDatasourceConfigCtrl</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> templateUrl <span class=\"token operator\">=</span> <span class=\"token string\">'datasource/partials/config.html'</span><span class=\"token punctuation\">;</span>\n  current<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">;</span>\n  datasourceSrv<span class=\"token punctuation\">:</span> any<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/** @ngInject */</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$scope<span class=\"token punctuation\">,</span> datasourceSrv</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>datasourceSrv <span class=\"token operator\">=</span> datasourceSrv<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>jsonData<span class=\"token punctuation\">.</span>services <span class=\"token operator\">=</span> <span class=\"token constant\">SERVICES</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// set all services selected</span>\n    _<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>jsonData<span class=\"token punctuation\">.</span>services<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">service</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>jsonData<span class=\"token punctuation\">[</span>service<span class=\"token punctuation\">.</span>service<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\">/* /src/datasource/partials/config.html */</code></pre></div>","frontmatter":{"title":"Grafana App 插件开发","date":"May 15, 2019","description":"Grafana App 插件开发"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/grafana/app_develop/","previous":{"fields":{"slug":"/javascript/object_oriented/"},"frontmatter":{"title":"JavaScript 基于原型的面向对象设计"}},"next":null}}