{"data":{"site":{"siteMetadata":{"title":"Blog","author":"susiezhao"}},"markdownRemark":{"id":"f2cb7447-4273-54aa-9e3c-8106caaaeb77","excerpt":"Grafana APP 插件 Grafana 是一个开源的时序性统计和监控平台，支持例如 elasticsearch、graphite、influxdb 等众多的数据源，并以功能强大的界面编辑器著称，允许您对指标进行查询、可视化展示、设置告警等操作，以及自定义配置仪表盘。  Grafana…","html":"<h1>Grafana APP 插件</h1>\n<p>Grafana 是一个开源的时序性统计和监控平台，支持例如 elasticsearch、graphite、influxdb 等众多的数据源，并以功能强大的界面编辑器著称，允许您对指标进行查询、可视化展示、设置告警等操作，以及自定义配置仪表盘。 </p>\n<p>Grafana 已经拥有一个强大的贡献者和插件开发者社区。开发者社区提供了三种类型的插件： </p>\n<ul>\n<li>Panel Plugin: 针对图形展示的面板插件；</li>\n<li>Datasource Plugin: 针对数据源的插件；</li>\n<li>App Plugin: 针对完整应用的插件，通常由 Panel 插件，Datasource 插件以及 dashboard 模板组成；</li>\n</ul>\n<p>本文主要介绍的是 App Plugin 的开发过程以及相关的代码组织。本文中的 App Plugin 插件主要由两部分组成 datasource 插件 和 dashboard 模板组成，其目录结构如下所示：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── CHANGELOG.md\n├── LICENSE\n├── README.md\n├── dist\n│   ├── README.md\n│   ├── components\n│   │   ├── config.html\n│   │   ├── config.js\n│   │   └── config.js.map\n│   ├── dashboards\n│   │   ├── example_cdb_dashboard.json\n│   │   └── example_cvm_dashboard.json\n│   ├── datasource\n│   │   ├── img\n│   │   │   └── tencent-cloud.svg\n│   │   ├── module.js\n│   │   ├── module.js.map\n│   │   ├── partials\n│   │   │   ├── annotations.editor.html\n│   │   │   ├── config.html\n│   │   │   ├── query.editor.html\n│   │   │   └── query.options.html\n│   │   └── plugin.json\n│   ├── img\n│   │   └── tencent-cloud.svg\n│   ├── module.js\n│   ├── module.js.map\n│   └── plugin.json\n├── jest.config.js\n├── package.json\n├── src\n│   ├── components\n│   │   ├── config.html\n│   │   └── config.ts\n│   ├── dashboards        // dashboard 模板\n│   │   ├── example_cdb_dashboard.json\n│   │   └── example_cvm_dashboard.json\n│   ├── datasource       // datasource plugin\n│   │   ├── __mocks__\n│   │   │   └── core_module.ts\n│   │   ├── components\n│   │   │   ├── custom_select_dropdown.ts\n│   │   │   └── multi_condition.ts\n│   │   ├── config.ctrl.ts\n│   │   ├── css\n│   │   │   └── query_editor.css\n│   │   ├── datasource.ts\n│   │   ├── img\n│   │   │   └── tencent-cloud.svg\n│   │   ├── module.ts\n│   │   ├── partials\n│   │   │   ├── annotations.editor.html\n│   │   │   ├── config.html\n│   │   │   ├── query.editor.html\n│   │   │   └── query.options.html\n│   │   ├── plugin.json\n│   │   ├── query.ctrl.ts\n│   │   ├── specs\n│   │   │   ├── tc_monitor_cdb_datasource.test.ts\n│   │   │   └── tc_monitor_cvm_datasource.test.ts\n│   │   ├── tc_monitor\n│   │   │   ├── cdb\n│   │   │   │   ├── cdb_query.ts\n│   │   │   │   ├── datasource.ts\n│   │   │   │   └── query_def.ts\n│   │   │   ├── cvm\n│   │   │   │   ├── cvm_query.ts\n│   │   │   │   ├── datasource.ts\n│   │   │   │   └── query_def.ts\n│   │   │   └── index.ts\n│   │   └── utils\n│   │       ├── constants.ts\n│   │       └── sign.ts\n│   ├── img\n│   │   └── tencent-cloud.svg\n│   ├── module.ts\n│   └── plugin.json\n├── tsconfig.jest.json\n├── tsconfig.json\n├── tslint.json\n├── webpack.config.analyze.js\n├── webpack.config.js\n└── webpack.config.prod.js</code></pre></div>\n<p>在插件开发中存在两个重要的配置文件： <code>plugin.json</code> 和 <code>module.ts</code>。</p>\n<ul>\n<li>\n<p><code>plugin.json</code>: 每一个插件中必不可少的文件，用于描述插件的相关信息。在 Grafana 服务启动时会扫描所有的插件文件夹并挂载每个插件的 dist 目录，并查找 <code>plugin.json</code> 文件，根据文件的内容完成插件的自动注册。 一个App plugin 的 plugion.json 如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n<span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 插件的类型： panel | app | datasource</span>\n<span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 插件名称</span>\n<span class=\"token string\">\"id\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"tencentcloud-monitor-app\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 插件ID, 必须唯一</span>\n<span class=\"token string\">\"info\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token string\">\"description\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor App for Grafana\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"author\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Tencent Cloud\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"keywords\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token string\">\"tencentcloud\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"tencentcloudmonitor\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"grafana\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"plugins\"</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"logos\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"small\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"large\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"img/tencent-cloud.svg\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2019-04-10\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"includes\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"dashboard\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"【实例】CDB 单机监控\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"dashboards/example_cdb_dashboard.json\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"dashboard\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"【实例】CVM 单机监控\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"dashboards/example_cvm_dashboard.json\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"type\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"datasource\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Tencent Cloud Monitor Datasource\"</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"dependencies\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"token string\">\"grafanaVersion\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"6.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token string\">\"plugins\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>其中 Datasource 插件独有两个属性，且其中至少有一个为 <code>true</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;metrics&quot;: true,   // 是否在panel中支持metrics\n&quot;annotations&quot;: false,  // 在dashboard中支持annotations查询</code></pre></div>\n</li>\n<li>\n<p><code>module.ts</code>：插件的入口文件，决定了插件的具体实现的。根据插件的类型不同其内容也有所差异。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// App Plugin 的 module.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span>\nConfigCtrl<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<p>// Datasource 的 module.ts\nexport {\nDatasource,\nConfigCtrl,\nAnnotationsQueryCtrl,\nQueryCtrl,\nQueryOptionsCtrl\n};</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">## 内容</code></pre></div>","frontmatter":{"title":"Grafana App 插件开发","date":"May 15, 2019","description":"Grafana App 插件开发"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/grafana/app_develop/","previous":{"fields":{"slug":"/javascript/object_oriented/"},"frontmatter":{"title":"JavaScript 基于原型的面向对象设计"}},"next":null}}